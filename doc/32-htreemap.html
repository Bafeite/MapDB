
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2013-12-30
 Rendered using Maven Reflow Skin 1.0.0 (http://andriusvelykis.github.com/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>HTreeMap | mapdb</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.2.2/cerulean/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/bootswatch.css" rel="stylesheet" />
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/reflow-skin.css" rel="stylesheet" />
		
		<link href="http://yandex.st/highlightjs/7.3/styles/github.min.css" rel="stylesheet" />
		
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/lightbox.css" rel="stylesheet" />
		
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/site.css" rel="stylesheet" />
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
<script src="js/excanvas.js"></script>
<script src="js/js-class.js"></script>
<script src="js/bluff.js"></script>
		<!-- Google Analytics -->
		<script type="text/javascript">
		
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-42074659-1']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();

		</script>
		</head>

	<body class="page-doc-32-htreemap project-mapdb" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="../"><img src="images/logo.png" border="0" alt="MapDB"/> - java beyond heap</a>
					<div class="nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">MapDB <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="../index.html" title="Index">Index </a></li>
									<li><a href="http://www.github.com/jankotek/mapdb" title="Github" class="externalLink">Github </a></li>
									<li><a href="../features.html" title="Features">Features </a></li>
									<li><a href="../changelog.html" title="Changelog">Changelog </a></li>
									<li><a href="../credits.html" title="Credits">Credits </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">FAQ <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="../faq-general.html" title="General">General </a></li>
									<li><a href="../faq-problems.html" title="Problems">Problems </a></li>
									<li><a href="../faq-performance.html" title="Performance">Performance </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="../intro.html" title="Intro">Intro </a></li>
									<li><a href="http://www.youtube.com/watch?v=FdZmyEHcWLI" title="Overview Video" class="externalLink">Overview Video </a></li>
									<li><a href="https://github.com/jankotek/MapDB/tree/master/src/test/java/examples" title="Examples" class="externalLink">Examples </a></li>
									<li><a href="../apidocs/index.html" title="JavaDoc">JavaDoc </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="http://groups.google.com/group/mapdb" title="Mail list" class="externalLink">Mail list </a></li>
									<li><a href="https://github.com/jankotek/MapDB/issues" title="Bug tracker" class="externalLink">Bug tracker </a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<ul id="toc" class="nav">
						<li class="toplevel"><a href="#htreemap" title="HTreeMap">HTreeMap</a></li>
						<li class="toplevel"><a href="#Parameters" title="Parameters">Parameters</a></li>
						<li class="toplevel"><a href="#Performance" title="Performance">Performance</a></li>
					</ul>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="page-header">
 <h1 id="htreemap">HTreeMap</h1>
</div> 
<p>HTreeMap (aka HashMap) is one of <tt>Map</tt>s offered by MapDB. It has great performance with large keys. It also offers entry expiration if time-to-live or maximal size is exceeded.</p> 
<p>HTreeMap is <i>segmented Hash Tree</i>. Most hash collections use an array for hash table, it requires copying all data when hash table is resized. HTreeMap uses auto-expanding 4 level tree, so it never needs resizing. </p> 
<p>To support concurrency HTreeMap is split to 16 independent segments, each with separate read-write lock. <tt>ConcurrentHashMap</tt> works similar way. Number of segments (sometimes called concurrency factor) is hard wired in design and can not be changed. </p> 
<p>HTreeMap optionally supports entry expiration based on three criteria: maximal size, time-to-live since last modification and time-to-live since last access. Expired entries are automatically removed. This feature uses FIFO queue, each segment has independent expiration queue. Priority per entry can not be set.</p> 
<div class="section"> 
 <h2 id="Parameters">Parameters</h2> 
 <p>HTreeMap has number of parameters to tune its performance. Number of segments (aka concurrency factor) is hard-coded in design 16 and can not be changed. Other params can be set only once when map is created.</p> 
 <p>TODO enum HTreeMap params * key serializer * value serializer * keep counter * TODO value outside nodes * value creator (get returns it instead of null when not found) * expire max size * expire ttl after update * expire ttl after read</p> 
</div> 
<div class="section"> 
 <h2 id="Performance">Performance</h2> 
 <p>HTreeMap has one major advantage for using with large keys. Unlike BTreeMap it only stores hash codes in tree nodes. Each lookup on BTreeMap deserializes number of tree nodes together with their keys.</p> 
 <p>TODO link to performance test, compare with BTreeMap</p> 
 <p>On other side HTreeMap has limited concurrency factor to 16, so its writes wont scale over 4 CPU cores. It uses read-write locks, so read operations are not affected. However in practice disk IO is more likely to be bottleneck.</p> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">MapDB</li>
						<li>
							<a href="../index.html" title="Index">Index </a>
						</li>
						<li>
							<a href="http://www.github.com/jankotek/mapdb" title="Github" class="externalLink">Github </a>
						</li>
						<li>
							<a href="../features.html" title="Features">Features </a>
						</li>
						<li>
							<a href="../changelog.html" title="Changelog">Changelog </a>
						</li>
						<li>
							<a href="../credits.html" title="Credits">Credits </a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">FAQ</li>
						<li>
							<a href="../faq-general.html" title="General">General </a>
						</li>
						<li>
							<a href="../faq-problems.html" title="Problems">Problems </a>
						</li>
						<li>
							<a href="../faq-performance.html" title="Performance">Performance </a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li>
							<a href="../intro.html" title="Intro">Intro </a>
						</li>
						<li>
							<a href="http://www.youtube.com/watch?v=FdZmyEHcWLI" title="Overview Video" class="externalLink">Overview Video </a>
						</li>
						<li>
							<a href="https://github.com/jankotek/MapDB/tree/master/src/test/java/examples" title="Examples" class="externalLink">Examples </a>
						</li>
						<li>
							<a href="../apidocs/index.html" title="JavaDoc">JavaDoc </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Support</li>
						<li>
							<a href="http://groups.google.com/group/mapdb" title="Mail list" class="externalLink">Mail list </a>
						</li>
						<li>
							<a href="https://github.com/jankotek/MapDB/issues" title="Bug tracker" class="externalLink">Bug tracker </a>
						</li>
						<li class="nav-header">Author</li>
						<li>
							<a href="http://www.kotek.net/" title="Blog" class="externalLink">Blog </a>
						</li>
						<li>
							<a href="http://www.twitter.com/jankotek" title="Twitter" class="externalLink">Twitter </a>
						</li>
						<li>
							<a href="mailto:jan@kotek.net" title="Email" class="externalLink">Email </a>
						</li>
						<li>
							<a href="http://www.kotek.net" title="About" class="externalLink">About </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><span class="color-highlight">MapDB</span> provides concurrent Maps, Sets and Queues backed by disk storage or off-heap memory.
It is a fast and easy to use embedded Java database engine. And it is completely free under Apache License.
MapDB is free as speech and free as beer under <a href="https://github.com/jankotek/MapDB/blob/master/license.txt">Apache License 2.0</a>.</blockquote>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2013. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 0.9.9-SNAPSHOT. </span><span class="publishDate">Last Published: 2013-12-30. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- Fallback jQuery loading from Google CDN:
	     http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
		if (typeof jQuery == 'undefined')
		{
			document.write(unescape("%3Cscript src='http://andriusvelykis.github.com/reflow-maven-skin//js/jquery-1.8.3.min.js' type='text/javascript'%3E%3C/script%3E"));
		}
	</script>
	
	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
	<script src="http://andriusvelykis.github.com/reflow-maven-skin//js/lightbox.js"></script>
	<script src="http://andriusvelykis.github.com/reflow-maven-skin//js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="http://andriusvelykis.github.com/reflow-maven-skin//js/jquery.ba-bbq.min.js"></script>
	<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script src="http://andriusvelykis.github.com/reflow-maven-skin//js/reflow-skin.js"></script>
	
	</body>
</html>
